<style>

        .bar {
          fill: #a1b5c0;
        }

        .bar:hover {
          fill: #DAE3E8;
        }

        .axis--x path {
          display: none;
        }


        </style>
<style type="text/css">
@font-face {
    font-family: 'galanogrotesque-bold';
    src: url('../../home/fonts/galano/galano-grotesque-bold-webfont.woff2') format('woff2'),
         url('../../home/fonts/galano/galano-grotesque-bold-webfont.woff') format('woff');
    font-weight: 200;
    font-style: normal;

}
@font-face {
    font-family: 'galanogrotesque';
    src: url('../../home/fonts/galano/galano-grotesque-webfont.woff2') format('woff2'),
         url('../../home/fonts/galano/galano-grotesque-webfont.woff') format('woff');
    font-weight: normal;
    font-style: normal;

}
	body {
		background-color: #ffffff;
		font-family: 'galanogrotesque-bold';
	}
	
	h3 {
		margin-left: 200px;
	}
	
	p {
		margin-left: 200px;
		font-size: 11pt;
		color: gray;
	}
	
	svg {
		background-color: white;
	}
	
	circle {
		stroke-width: 1;
	}
	
	circle.hombres {
		fill: #999;
	}
	
	circle.mujeres {
		fill: #721dac;
		opacity: 1;
	}
	
	circle:hover {
		stroke-width: 3;
		stroke: white;
	}
	
	line.grid {
		stroke: #eee;
	}
	
	line.between {
		stroke: black;
	}
	
	.axis path,
	.axis line {
		fill: none;
		stroke: black;
		shape-rendering: crispEdges;
	}
	
	.axis text {
		font-family: 'galanogrotesque';
		font-size: 11px;
	}
	
	.xlabel {
		font-famile: 'galanogrotesque';
		font-size: 11px;
		color: gray;
	}
	
	.tick line{
	  opacity: 0.1;
	  stroke-width: 0.5;
	}
	.tipsy {  padding: 5px; z-index: 100000;top:0;right:0; }
	.tipsy-inner {  text-align: center; position:absolute; }

	</style>
<svg id="graph" width="960" height="500"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>
    /* Configuración del tamaño de la caja del canvas o SVG */
    var svg = d3.select("svg"),
        margin = {top: 20, right: 20, bottom: 30, left: 50},
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    
    // Se definen las variables de los ejes X y Y
    var parseTime = d3.timeParse("%Y");
    // Rangos de fechas para líneas
    //var x = d3.scaleTime().range([0, width]);
    
    //var y = d3.scale.ordinal().rangeRoundBands([0, width], .1);
    //var y = d3.scaleBand().rangeRound([0, width]).padding(0.1);
    //var x = d3.scaleLinear().rangeRound([height, 0]);
    
    
    // Valores para Líneas
//    var x = d3.scaleTime().range([0, width]);
//    var y = d3.scaleLinear().rangeRound([height, 0]);
    
    
    // Valores para Barras
//    var x = d3.scaleBand().rangeRound([0, width]).padding(0.1);
//    var y = d3.scaleLinear().rangeRound([height, 0]);
    
    
    // Valores para dotplot
   // var widthScale = d3.scaleLinear().range([ 0, width]);

	//var heightScale = d3.scaleLinear().rangeRound([ margin.top, height], 0.2);
//    var x = d3.scaleLinear().range([0, width]);
//    var y = d3.scaleLinear().rangeRound([height, 0]);
    
    var y = d3.scaleTime().range([height, 0]);
    var x = d3.scaleLinear().range([0, width]);
    
    
    
    
//    var xAxis = d3.svg.axis()
//					.scale(widthScale)
//					.orient("bottom");
//
//	var yAxis = d3.svg.axis()
//					.scale(heightScale)
//					.orient("left")
//					.innerTickSize(-width)
//					.outerTickSize(0)
//					.tickPadding(10);

    // Se crea la variable de la línea con las variables que va a graficar en cada eje
//    var line = d3.line()
//        .x(function(d) { return x(d['Periodo']); })
//        .y(function(d) { return y(d['poblacion_de_18_anios_o_mas']); });

    // Se crea la variable que mostrará el tooltip
    var tooltip = d3.select("body").append("div").attr("class", "toolTip");

    // Cargamos los datos del JSON
    d3.json("AaR02.json", function(error, data) {
        if (error) throw error;
        console.log(data);
        
        // Se llama a la función que construye el gráfico
        // Llama a función de Líneas
        //lineas(data);
        
        // Llama a función de Barras
        //barras(data);
        
        // Llama a función de Dotplot
        dotplot(data);
        
        
    });
    
    
    
    function lineas(data){
        // Aquí cargamos los datos
        data.forEach(function(d) {
            d['Periodo'] = parseTime(d['Periodo']);
            d['poblacion_de_18_anios_o_mas'] = +d['poblacion_de_18_anios_o_mas'];
            d['poblacion_con_menos_de_18_anios'] = +d['poblacion_con_menos_de_18_anios'];
            console.log(d['Periodo']);
          });
        
        // Aquí se define el dominio de los ejes X y Y
        x.domain(d3.extent(data, function(d) { return d['Periodo']; }));
        //x.domain(data.map(function(d) {return d['Periodo'];}));
        //x.domain(data.map(function(d){ return d.Periodo; }));
        y.domain(d3.extent(data, function(d) { return d['poblacion_de_18_anios_o_mas']; }));

        // Dibuja el eje X
        g.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x).tickFormat(d3.timeFormat("%Y")))
            .select(".domain");

        // Dibuja el eje Y y anota el atributo del eje
        g.append("g")
            .call(d3.axisLeft(y))
            .append("text")
            .attr("fill", "#000")
            .attr("transform", "rotate(-90)")
            .attr("y", -50)
            .attr("dy", "0.71em")
            .attr("text-anchor", "end")
            .text("Unidades");

        // Dibuja la línea
        g.append("path")
            .datum(data)
            .attr("class","line")
            .attr("fill", "none")
            .attr("stroke", "#a1b5c0")
            .attr("stroke-linejoin", "round")
            .attr("stroke-linecap", "round")
            .attr("stroke-width", 5)
            .attr("d", line);

        // Dibuja círculos en la línea
        g.selectAll("circle")
            .data(data).enter().append("svg:circle")
            .attr("cx", function(d) { return x(d['Periodo']);})
            .attr("cy", function(d) {return y(d['poblacion_de_18_anios_o_mas'])})
            .attr("fill", "#a1b5c0")
            .attr("fill-opacity","0").attr("r", 6)
            .on("mouseover", function(d,i) {  
                tooltip
                    .style("left", d3.event.pageX - 25 + "px")
                    .style("top", d3.event.pageY - 30 + "px")
                    .style("display", "inline-block")
                    .text(d['poblacion_de_18_anios_o_mas']);
            })
            .on("mouseout", function(d){
                tooltip.style("display", "none");
            });
        
    }
    
    
    function barras(data){
        
        data.forEach(function(d) {
            d['Periodo'] = d['Periodo'];
            d['poblacion_de_18_anios_o_mas'] = +d['poblacion_de_18_anios_o_mas'];
            d['poblacion_con_menos_de_18_anios'] = +d['poblacion_con_menos_de_18_anios'];
            console.log(d['Periodo']);
          });
          x.domain(data.map(function(d) { return d['Periodo']; }));
          y.domain([0, d3.max(data, function(d) { return d['poblacion_de_18_anios_o_mas']; })]);

          g.append("g")
              .attr("class", "axis axis--x")
              .attr("transform", "translate(0," + height  + ")")
              .call(d3.axisBottom(x));

//          g.append("g")
//              .attr("class", "axis axis--y")
//              .call(d3.axisLeft(y))
//            .append("text")
//              .attr("transform", "rotate(-90)")
//              .attr("y", 6)
//              .attr("dy", "0.71em")
//              .attr("text-anchor", "end")
//              .text("Unidades");

            g.append("g")
              .call(d3.axisLeft(y))
            .append("text")
              .attr("fill", "#000")
              .attr("transform", "rotate(-90)")
              .attr("y", -50)
              .attr("dy", "0.71em")
              .attr("text-anchor", "end")
              .text("Unidades");

          g.selectAll(".bar")
            .data(data)
            .enter().append("rect")
              .attr("class", "bar")
              .attr("x", function(d) { return x(d['Periodo']); })
              .attr("y", function(d) { return height; })
              .attr("width", x.bandwidth())
              .attr("height", function(d) { return 0})
            .on("mousemove", function(d){
                    tooltip
                      .style("left", d3.event.pageX - 25 + "px")
                      .style("top", d3.event.pageY - 40 + "px")
                      .style("display", "inline-block")
                    .text(d['poblacion_de_18_anios_o_mas']);
                })
                .on("mouseout", function(d){ tooltip.style("display", "none");})
               .transition()
               .delay(function(d,i){ return i*100 })
               .duration(2000)
                .attr('y', function(d){ return y(d['poblacion_de_18_anios_o_mas'])})
               .attr('height', function(d){ return height - y(d['poblacion_de_18_anios_o_mas']) });
    }
    
    
    function dotplot(data){
        
//        data.sort(function(a, b) {
//			return d3.descending(+a.puntos_m, +b.puntos_m);
//		});
        
        data.forEach(function(d) {
            d['Periodo'] = +d['Periodo'];
            d['poblacion_de_18_anios_o_mas'] = +d['poblacion_de_18_anios_o_mas'];
            d['poblacion_con_menos_de_18_anios'] = +d['poblacion_con_menos_de_18_anios'];
            console.log(d['Periodo']);
          });
        
		//y.domain([600, 0]);
//
//		// js map: will make a new array out of all the d.pais fields
//		y.domain(data.map(function(d) { return d['Periodo']; } ));
        
        //y.domain(data.map(function(d) { return d['Periodo']; }));
        y.domain(data.map(function(d) { return d['Periodo']; } ));
        x.domain([0, d3.max(data, function(d) { return d['poblacion_de_18_anios_o_mas']; })]);


		// Make the faint lines from y labels to highest dot

		var linesGrid = svg.selectAll("lines.grid")
			.data(data)
			.enter()
			.append("line");

		linesGrid.attr("class", "grid")
			.attr("x1", margin.left)
			.attr("y1", function(d) {
            
            console.log(y);
				return y(d['Periodo']) + y.range()/2;
                //return 50;
			})
			.attr("x2", function(d) {
				return margin.left + x(+d['poblacion_de_18_anios_o_mas']);

			})
			.attr("y2", function(d) {
				//return y(d['Periodo']) + y.range()/2;
                return 340;
			});

		// Make the dotted lines between the dots

		var linesBetween = svg.selectAll("lines.between")
			.data(data)
			.enter()
			.append("line");

		linesBetween.attr("class", "between")
			.attr("x1", function(d) {
				return margin.left + x(+d['poblacion_con_menos_de_18_anios']);
			})
			.attr("y1", function(d) {
				//return y(d['Periodo']) + y.range()/2;
                return 250;
			})
			.attr("x2", function(d) {
				return margin.left + x(d['poblacion_de_18_anios_o_mas']);
			})
			.attr("y2", function(d) {
				//return y(d['Periodo']) + y.range()/2;
                return 430;
			})
			.attr("stroke-dasharray", "1,3")
			.attr("stroke-width", function(d, i) {
				if (i == 7) {
					return "1";
				} else {
					return "0.5";
				}
			});


		// Puntos para porcentaje de mujeres

		var puntos_mujeres = svg.selectAll("circle.mujeres")
				.data(data)
				.enter()
				.append("circle");

		puntos_mujeres
			.attr("class", "mujeres")
			.attr("cx", function(d) {
				return margin.left + x(+d['poblacion_con_menos_de_18_anios']);
			})
			.attr("r", 7)//y.range()/2)
			.attr("cy", function(d) {
				//return y(d['Periodo']) + y.range()/2;
                return 270;
			})
			.style("stroke", function(d){
				if (d['Periodo'] === "Promedio OCDE") {
					return "black";
				}
			})
			.style("fill", function(d){
				if (d['Periodo'] === "Promedio OCDE") {
					return "#721dac";
				}
			});

		// Puntos para porcentaje de hombres

		var puntos_hombres = svg.selectAll("circle.hombres")
				.data(data)
				.enter()
				.append("circle");

		puntos_hombres
			.attr("class", "hombres")
			.attr("cx", function(d) {
				return margin.left + x(+d['poblacion_de_18_anios_o_mas']);
			})
			.attr("r",7)// y.range()/2)
			.attr("cy", function(d) {
				//return y(d['Periodo']) + y.range()/2;
                return 300;
			})
			.style("stroke", function(d){
				if (d['Periodo'] === "Promedio OCDE") {
					return "black";
				}
			})
			.style("fill", function(d){
				if (d['Periodo'] === "Promedio OCDE") {
					return "#999";
				}
			})
			.append("title")
			.text(function(d) {
				return d['Periodo'] + ": " + d['poblacion_de_18_anios_o_mas'] + "%";
			});

			// add the axes

		svg.append("g")
			.attr("class", "x axis")
			.attr("transform", "translate(" + margin.left + "," + height + ")")
			.call(x);

		svg.append("g")
			.attr("class", "y axis")
			.attr("transform", "translate(" + margin.left + ",0)")
			.call(y);

		svg.append("text")
			.attr("class", "xlabel")
        	.attr("transform", "translate(" + (margin.left + width / 2) + " ," +
        				(height + margin.bottom) + ")")
        	.style("text-anchor", "middle")
        	.attr("dy", "12")
        	.text("Puntaje promedio");
        	
        	
        	
        	svg.selectAll("circle")
	         .data(data)
	       .enter().append("svg:circle")
	         .attr("stroke", "#fff")
	         .attr("fill", function(d, i) { return '#f00'; })
	         .attr("cx", function(d, i) { return d.x; })
	         .attr("cy", function(d, i) { return d.y; })
	         .attr("r", function(d, i) { return d.r; });
	        

      

//	        $('svg circle').tipsy({ 
//	        trigger: 'hover',
//	        delayOut: 1000,
//	        fade: true,
//	        gravity: 'w', 
//	        html: true,
//	        opacity: 1,
//	        title: function() {
//	          var d = this.__data__, c = '#f00';
//	          var brecha = d.puntos_h-d.puntos_m;
//	          $('#tooltip').html("<div style='background:#fff;color:#C0DAEF;padding:10px;left:665px;box-shadow:2px 2px 5px #bbb;padding:0px !important;width:260px;text-align:center;position:absolute;top:330px;'><h2 style='margin-top:0px;background:#111;color:#fff;padding:8px;font-family:galanogrotesque-bold;'>" + d.pais + "</h2><p style='background:#fff;color:#333;font-family:galanogrotesque-bold;margin-left:5px;padding-right:10px;padding-top:0px;margin-top:-10px;'>Puntaje promedio niñas: " + d.puntos_m + "</p><p style='background:#fff;color:#333;font-family:galanogrotesque-bold;margin-left:5px;padding-right:10px;padding-bottom:0px;margin-top:-10px;'>Puntaje promedio niños: " + d.puntos_h + "</p><p style='background:#fff;color:#333;font-family:galanogrotesque-bold;margin-left:5px;padding-right:10px;padding-bottom:0px;margin-top:-10px;'>Brecha: " + brecha.toFixed(1) + "</p></div>");
//	          //return "<div style='background:#fff;color:#C0DAEF;padding:10px;right:0;bottom:0;box-shadow:2px 2px 5px #bbb;padding:0px !important;width:300px;text-align:center;'><h2 style='background:#111;color:#fff;padding:8px;font-family:galanogrotesque-bold;'>" + d.pais + "</h2><p style='background:#fff;color:#333;font-family:galanogrotesque-bold;margin-left:5px;padding-right:10px;padding-top:0px;margin-top:-10px;'>% mujeres: " + d.puntos_m + "</p><p style='background:#fff;color:#333;font-family:galanogrotesque-bold;margin-left:5px;padding-right:10px;padding-bottom:10px;margin-top:-10px;'>% hombres: " + d.puntos_h + "</p></div>";
//	          return "";
//	
//	        }
//	      	});


       	// Style one of the Y labels bold:

        // a hack that works if you can unravel the selections - to style "The World" bold in the axis label, which is the 8th element:
        var allYAxisLabels = d3.selectAll("g.y.axis g.tick text")[0]; // un-nest array
        console.log(allYAxisLabels);
        d3.select(allYAxisLabels[4]).style("font-weight", "normal");
        	// You could also use tick formatting to get a % sign on each axis tick

        console.log(allYAxisLabels);
        
        
			//});

/*

Se agregan Leyendas
*/

		svg.append('text')
		.attr("x", 550)
		.attr("y", 273)
		.attr("fill","#721dac")
		.text(".")
		.attr("font-family", "Comic Sans")
	    .attr("font-size", "102px")
		.attr("stroke", "#721dac");
		
		svg.append('text')
		.attr("x", 550)
		.attr("y", 294)
		.attr("fill","#999")
		.text(".")
		.attr("font-family", "Comic Sans")
	    .attr("font-size", "102px")
		.attr("stroke", "#999");
		
		svg.append('text')
		.attr("x", 560)
		.attr("y", 310)
		.attr("fill","#721dac")
		.text(". . .")
		.attr("font-family", "Helvetica Neue")
		.attr("font-weight", "900")
	    .attr("font-size", "11px")
		.attr("stroke", "#999");

		
		

	   svg.append("text")
	     .attr("x", 585)
	     .attr("y", 273)
	     .text("Niñas")                        
	     .attr("font-family", "Helvetica Neue")
	     .attr("font-size", "11px")
	     .attr("fill", "black");
	     
	     
   	   svg.append("text")
	     .attr("x", 585)
	     .attr("y", 293)
	     .text("Niños")                        
	     .attr("font-family", "Helvetica Neue")
	     .attr("font-size", "11px")
	     .attr("fill", "black");	
	     
   	   svg.append("text")
	     .attr("x", 585)
	     .attr("y", 313)
	     .text("Diferencia")                        
	     .attr("font-family", "Helvetica Neue")
	     .attr("font-size", "11px")
	     .attr("fill", "black");
        
    }
    
    
   </script>